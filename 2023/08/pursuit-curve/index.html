<!DOCTYPE html><html lang="en" data-default-color-scheme="dark"><head><style>@import url(https://fonts.googleapis.com/css2?family=Fira+Code&display=swap);code,pre>span{font-family:'Fira Code',sans-serif!important;font-display:swap}</style><style>.video-container{position:relative;padding-bottom:56.25%;padding-top:30px;margin-bottom:16px;height:0;overflow:hidden}.video-container embed,.video-container iframe,.video-container object{position:absolute;top:0;left:0;width:100%;height:100%}</style><style>.group-image-wrap{align-items:center}.group-image-wrap .fancybox{width:-webkit-fill-available;width:-moz-fill-available;width:-moz-available;width:fill-available}.group-image-container img{width:-webkit-fill-available;width:-moz-fill-available;width:-moz-available;width:fill-available}.post-content img{max-height:350px}</style><style>.markdown-body>table{display:table!important}</style><style>@media (min-width:992px){.post-content,post-custom{padding-left:12%!important;padding-right:12%!important}}</style><style>h1,h2,h3,h4,h5,h6,h7{font-family:"PingFang SC","Hiragino Sans GB","Microsoft Yahei","WenQuanYi Micro Hei","Segoe UI Emoji","Segoe UI Symbol",Helvetica,Arial,-apple-system,system-ui,sans-serif!important}</style><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.webp"><link rel="icon" href="/img/favicon.webp"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="phantom0174"><meta name="keywords" content="追蹤曲線, pursuit curve, radiodrome, differential equation, euler method, rk4 method, laplace transform, terraria, wall of flesh"><meta name="description" content="從 Terraria 發想的小研究"><meta property="og:type" content="article"><meta property="og:title" content="有關追蹤曲線"><meta property="og:url" content="https://phantom0174.github.io/2023/08/pursuit-curve/index.html"><meta property="og:site_name" content="Quantami"><meta property="og:description" content="從 Terraria 發想的小研究"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://phantom0174.github.io/assets/cover/pursuit-curve.avif"><meta property="article:published_time" content="2023-08-26T16:00:00.000Z"><meta property="article:modified_time" content="2023-09-10T03:20:00.000Z"><meta property="article:author" content="phantom0174"><meta property="article:tag" content="mafs"><meta property="article:tag" content="program"><meta property="article:tag" content="life"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://phantom0174.github.io/assets/cover/pursuit-curve.avif"><title>有關追蹤曲線 | Quantami</title><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.1/css/bootstrap.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="/css/main.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link id="highlight-css" rel="preload" href="/css/highlight.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link id="highlight-css-dark" rel="preload" href="/css/highlight-dark.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="stylesheet" href="/css/fonts.css"><link rel="preload" href="/css/icomoon/style.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"phantom0174.github.io",root:"/",version:"1.9.5",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:["post"]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:"❡"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/placeholder.webp",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:{measurement_id:"G-7FGHSBCQB5"},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"rOQP33bXoE3wMPKnTsA70Duj-MdYXbMMI",app_key:"7BbpOToJ4BxNyKA2EgBND34r",server_url:null,path:"window.location.pathname",ignore_local:!0}},search_path:"/local-search.xml",include_content_in_search:!0};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-7FGHSBCQB5",function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","G-7FGHSBCQB5")})</script><style>.toc-title{font-weight:700!important;font-size:1.7em}.toc{font-weight:700!important}.toc-level-1{font-size:1.3rem}.toc-level-2{font-size:1.2rem}.toc-level-3{font-size:1.1rem}</style><style>.katex>.katex-html{white-space:nowrap;overflow-x:scroll;overflow-y:hidden}.katex>.katex-html>.tag{position:relative!important;left:10%!important}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><style>#subtitle,.typed-cursor{font-size:2.2rem;animation:blinking 2s ease-in-out .5s infinite alternate}@keyframes blinking{from{text-shadow:none}to{text-shadow:0 0 10px #fc0,0 0 20px #fc0,0 0 40px #fc0}}@media (max-width:991px){#subtitle,.typed-cursor{font-size:2.1rem}}@media (max-width:767px){#subtitle,.typed-cursor{font-size:2rem}}@media (max-width:544px){#subtitle,.typed-cursor{font-size:1.8rem}}@media (max-width:432px){#subtitle,.typed-cursor{font-size:1.6rem}}</style><style type="text/css">.spoiler{display:inline}p.spoiler{display:flex}.spoiler a{pointer-events:none}.spoiler-blur,.spoiler-blur>*{transition:text-shadow .5s ease}.spoiler .spoiler-blur,.spoiler .spoiler-blur>*{color:transparent;background-color:rgba(0,0,0,0);text-shadow:0 0 10px grey;cursor:pointer}.spoiler .spoiler-blur:hover,.spoiler .spoiler-blur:hover>*{text-shadow:0 0 5px grey}.spoiler-box,.spoiler-box>*{transition:color .5s ease,background-color .5s ease}.spoiler .spoiler-box,.spoiler .spoiler-box>*{color:#000;background-color:#000;text-shadow:none}</style><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/rss.xml" title="Quantami" type="application/rss+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Quantami</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>Archive</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>About</span></a></li><li class="nav-item"><a class="nav-link" href="/links/" target="_self"><i class="iconfont icon-link-fill"></i> <span>Friends</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-bookmark-fill"></i> <span>Others</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/2023/11/site-logs/" target="_self"><i class="iconfont icon-cliplist"></i> <span>Site logs</span> </a><a class="dropdown-item" href="/subscription/" target="_self"><i class="iconfont icon-rss"></i> <span>Subscription</span></a></div></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/assets/banner/pursuit-curve.avif) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.5)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="有關追蹤曲線"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-08-27 00:00" pubdate>Sunday, August 27th 2023, 12:00 am</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.4k words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 24 mins </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> views</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="col-lg-10 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">有關追蹤曲線</h1><p class="note note-light">Last updated on September 10, 2023</p><div class="markdown-body"><p class="toc-title">Contents</p><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%91%B8%E7%B4%A2"><span class="toc-text">摸索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E4%BC%B8"><span class="toc-text">延伸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B5%90%E5%B0%BE"><span class="toc-text">結尾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2023-9-9-%E6%9B%B4%E6%96%B0%EF%BC%9A%E6%A8%A1%E6%93%AC%E6%96%B9%E5%BC%8F"><span class="toc-text">2023&#x2F;9&#x2F;9 更新：模擬方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2023-9-10-%E6%9B%B4%E6%96%B0%EF%BC%9A%E9%AC%BC%E6%8A%93%E4%BA%BA%E6%A8%A1%E5%9E%8B%E6%A8%A1%E6%93%AC"><span class="toc-text">2023&#x2F;9&#x2F;10 更新：鬼抓人模型模擬</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%8C%E8%A8%98"><span class="toc-text">後記</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A8%BB%E8%85%B3"><span class="toc-text">註腳</span></a></li></ol><h2 id="前言">前言</h2><p>  筆者這個暑假有段時間沉迷於開放世界型遊戲（典型的報復性沉迷 uwu），其中包含了知名的 Terraria。先說個題外話：這是筆者第一次破關（打完 Moonlord），花了成噸的時間在上面，不過娛樂性相當值得 \^~^。</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="terraria-house.avif" srcset="/img/placeholder.webp" lazyload alt="Home sweet home"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="terraria-save.avif" srcset="/img/placeholder.webp" lazyload alt="精神時光屋"></div></div></div><p>  玩過的人應該知道，Terraria 中有一個叫 <a target="_blank" rel="noopener" href="https://terraria.wiki.gg/zh/wiki/%E8%A1%80%E8%82%89%E5%A2%99">Wall Of Flesh (WoF)</a> 的 Boss。WoF 有一種特殊的 debuff - 狂卷之舌：當你在距離牠太遠時會伸出舌頭把你拉回去。</p><p>  筆者在玩的時候就想到，如果玩家利用魔鏡傳送回地表後馬上開始被拉回去地獄時，玩家的軌跡 <strong>真正來說</strong> 會長怎樣呢<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="假設玩家可以存活到被拉到 WoF 身旁，且拉的速度為等速。">[1]</span></a></sup>？因為在拉的過程中 WoF 並不會靜止不動，而是邊拉著玩家邊前進，造成軌跡會有一定程度的彎曲。而這個東西，讓筆者想起來了之前有看過但沒有詳細研究<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="其實有想詳細研究過，但被打斷了，詳細原因等等再說。">[2]</span></a></sup>的追蹤曲線 - <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%BF%BD%E8%B8%AA%E6%9B%B2%E7%BA%BF">pursuit curve</a>，研究正式開始。</p><p><img src="curve-spoiler.avif" srcset="/img/placeholder.webp" lazyload alt="spoiler: 會長醬"></p><h2 id="正文">正文</h2><h3 id="摸索">摸索</h3><p>  在實際狀況下，玩家是被拉著前進；但其實可以把問題看成是：玩家以等速向著 WoF 追去；WoF 以等速前進，讓這個問題符合 pursuit curve 的定義。更準確來說，是 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Radiodrome">Radiodrome</a> 的定義，也就是追蹤的目標會以等速前進的狀況。</p><p>  筆者列了些基本的式子：</p><p>$$ \textbf{H}_t = v_h\ \frac{\textbf{W} - \textbf{H}}{|\textbf{W} - \textbf{H}|},\ \textbf{W} = (x_W - v_w\,t,\ y_W) $$</p><p>其中 H 是玩家（human）；W 是 WoF； $\textbf{H}$ 是玩家的位置向量；$\textbf{W}$ 是 WoF 的位置向量；$v_i$ 就代表各自的移動速度。</p><p>  筆者一開始想要從這個微分方程解 time-dependent path，結果發現怎麼解都解不出來，把那條向量微分方程式換元也只能得到一條裡面有 unit vector 的 DE。筆者還特地去問了台大物理系的朋朋，結果他也不知道要怎麼處理那個鬼東西 qq。</p><p>  最後翻到 radiodrome 的 wiki page 時才發現這個東西根本沒辦法解 time-dependent，光解 x-y functional relation 的步驟就夠難了。</p><p>  接下來，筆者基本上就是先照著 wiki page 上面的解法一步步嘗試理解 <span class="spoiler" onclick='this.classList.toggle("spoiler")'><span class="spoiler-blur">真的有點難 owo</span></span>，理解完後再用自己的符號習慣重新解了 x-y 軸翻轉後的版本（因為 Terraria 的世界是橫向），最後再把解出來的結果放進 Desmos 中模擬進行結果驗證。以下是解出來的路徑結果與 <a target="_blank" rel="noopener" href="https://www.desmos.com/calculator/yspi1pjjkn?lang=zh-TW">Desmos 模型</a>：</p><p>$$ x\left(y\right) = H_x + \int_{0}^{y}\sinh\left(c + V\ln\left(1 - \frac{Y}{W_y}\right)\right)\,dY \\ c = \sinh^{-1}\left(\frac{W_x - H_x}{W_y - H_y}\right),\ V = \frac{v_w}{v_h} $$</p><p>其中 $H,\ W$ 下標 $x,\ y$ 是兩個體的初始位置（initial value）。</p><blockquote><p>這個積分其實寫得出封閉形式，但因為有點小長所以還是寫積分式比較漂亮 uwu。</p></blockquote><hr><h3 id="延伸">延伸</h3><p>  光解出這個 pursuit curve 的筆者並不滿足，畢竟這只是其中一個特殊狀況：目標要等速，移動方向要平行兩軸之一且只能是直線。所以筆者去找了些 paper，像是在 <a target="_blank" rel="noopener" href="https://www.researchgate.net/publication/298480827_Pursuit_Curves_and_Ordinary_Differential_Equations">Pursuit Curves and Ordinary Differential Equations</a> 這篇裡面就教你怎麼解 multi-pursuer 的狀況，這也是筆者在文章前面說「曾經看過」的東西，在下一段<strong>小提</strong>一下。</p><p>  筆者在高中時候曾經看過 multi-pursuer 的問題，但那時候的筆者顯然是完全不知道為什麼這個問題的路徑會是 <strong>對數螺線</strong>，所以跑去問補習班的物理老師。結果那位老師就百般刁難筆者的問題敘述方式<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="簡述一下那位物理老師的話：「你連怎麼說這個情況都會說不清楚那還解甚麼題目，但老師還是幫你看一下，**看了 1 分鐘多**，啊這個老師也不知道怎麼解要想一下。」直接笑死，根本不會解；不過完全不意外，蠻多筆者遇過的補習班老師在問同領域的課外問題時的回應幾乎都是「要想一下」，那時早就習慣了##。">[3]</span></a></sup>，完全脫離了筆者問問題的本意<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="我是來學習不是來聽文不對題的廢話。">[4]</span></a></sup>；所以筆者就氣到直接把這個東西擺在旁邊，回去乖乖學物理。</p><p>  現今，在大一下學了工程數學中的 Laplace transform 之後的筆者剛好看得懂這篇 paper 中的解法，所以理解起來並無大礙，也算是攻克了一個長年疑問。</p><hr><h3 id="結尾">結尾</h3><p>  此外，筆者在翻更多資料時也發現了這個<a target="_blank" rel="noopener" href="https://mathcurve.com/courbes2d.gb/poursuite/poursuite.shtml">紀載了巨多曲線資訊的網站</a>。其中關於 pursuit-curve 的介紹 &amp; 另一篇 paper 讓筆者知道 pursuit-curve 確實不是這麼好解的東西。</p><blockquote><p>筆者記得在 general-form 下會是一個 $\partial_2$ Non-linear DE，可以先不用嘗試求解了 owo。</p></blockquote><p>  所以，筆者又自己在 Desmos 中建了一個 <a target="_blank" rel="noopener" href="https://www.desmos.com/calculator/pz1rfnm4ol?lang=zh-TW">Simulator of general-form pursuit curve 的模型</a>，有興趣的人也歡迎去玩玩看！（還支持軌跡功能呦 ^~^）</p><hr><h3 id="2023-9-9-更新：模擬方式">2023/9/9 更新：模擬方式</h3><p>  筆者一開始進行模擬時（也就是用數值法求解 DE）是用 Euler method，今天在看這個影片時候學到了名為 <strong>RK4</strong> 的新方法！</p><div class="video-container"><iframe src="https://www.youtube.com/embed/TtgS-b191V0" frameborder="0" loading="lazy" allowfullscreen></iframe></div><p>普通的 Euler method 在逼近時只用了一步，但 RK4 代表在逼近時前前後後用了總共 4 步，最後再取平均來獲得更精確的估計值。而 total accumulated error 的複雜度會是 $O(\text{dt}^p)$，其中 $p$ 為更新步數，$\text{dt}$ 為更新時間差。</p><p>所以 RK4 會比 Euler method 還要再更精確許多，如上影片中 3:32 左右講述的：使用 Euler method 要求出不發散的解需要以 600KHz 進行模擬；但使用 RK4 只需要 300Hz 就可得出穩定解。</p><p>筆者去找了些 RK4 的教學影片後，也嘗試利用看看在暑假學了一些的 Unity 去寫了 pursuit-curve 的模擬器，並在裡面實現 Vector DE 版本的 RK4 更新，如下：</p><div class="fold"><div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-65ad56e5" role="button" aria-expanded="false" aria-controls="collapse-65ad56e5"><div class="fold-arrow">▶</div>Unity code</div><div class="fold-content collapse" id="collapse-65ad56e5"><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RK4UpdatePos</span>()</span><br>&#123;<br>    Vector3 k1 = dP(targetClass.T_total, trans.position),<br>        k2 = dP(targetClass.T_total + dt / <span class="hljs-number">2</span>, trans.position + dt / <span class="hljs-number">2</span> * k1),<br>        k3 = dP(targetClass.T_total + dt / <span class="hljs-number">2</span>, trans.position + dt / <span class="hljs-number">2</span> * k2),<br>        k4 = dP(targetClass.T_total + dt, trans.position + dt * k3);<br><br>    Vector3 avr = (k1 + <span class="hljs-number">2</span> * k2 + <span class="hljs-number">2</span> * k3 + k4) / <span class="hljs-number">6</span>;<br>    trans.position += dt * avr;<br>&#125;<br><br><span class="hljs-function">Vector3 <span class="hljs-title">dP</span>(<span class="hljs-params"><span class="hljs-built_in">float</span> t, Vector3 p</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> moveSpeed * (targetClass.PathPos(t) - p).normalized;<br>&#125;<br></code></pre></td></tr></table></figure></div></div><p>也放上一張模擬的結果owo：</p><p><img src="simu0.avif" srcset="/img/placeholder.webp" lazyload alt="$T(t) = (\cos(t), \cos(t)^3)$"></p><p>總地來說，Desmos 和 Unity 在效能上真的差超多；但或許是因為追蹤曲線的 DE 過於簡單，Euler &amp; RK4 之間的模擬只有在 Target path 非常極端的狀況下才會有微小差異。</p><p>反正學到新東西就是爽爽的uwu。</p><hr><h3 id="2023-9-10-更新：鬼抓人模型模擬">2023/9/10 更新：鬼抓人模型模擬</h3><p>  繼昨天的模擬之後，筆者在晚上時突然想到了可以把鬼抓人的行為描述成微分方程，如下：</p><p>$$ \left\{\begin{matrix} \begin{align*} \frac{dP}{dt} &= V_P \cdot \Lambda (T-P)\\ \frac{dT}{dt} &= V_T \cdot \Lambda \left[\Lambda (T-P)(1-\alpha)+R_{\theta}\,\hat{\tau}(t)\alpha \right] \end{align*} \end{matrix}\right. $$</p><p>其中 $P$ 擔任鬼的角色；$T$ 就是人。$\Lambda(v)$ 代表 $\hat{v}$ <span class="spoiler" onclick='this.classList.toggle("spoiler")'><span class="spoiler-blur">因為對於很長的 $v$ 來說只有個小 hat 太不明顯了，所以寫成 function 型態</span></span>。</p><p>也順便解釋一下各個式子的意義：$P_t$ 沒甚麼好講，跟 pursuit curve 的狀況一樣；$T_t$ 的意思是：人除了會往反方向逃離（$\Lambda (T-P)$），同時也會受想要逃離鬼的心理作祟，亦或者是受場地大小限制而拐彎（$R_{\theta},\hat{\tau}(t)$）。而 $\alpha$ 就是作為這兩者心理因素的加權平均值，最後再將向量合 normalize 之後乘上 $V_T$ 即為人的逃跑微分方程。</p><p>其中 $R_{\theta}$ 是用來修正坐標系的旋轉矩陣，$\theta$ 是以下函數：</p><p>$$ \theta=\text{atan2}\left(T-P\right) $$</p><p>但要用 RK4 解這組向量微分方程組的話，就必須要把這個方程組合併，並鑲入 $\mathbb{R}^5$ 中（在 Unity 裡實作時其實是 $\mathbb{R}^7$），如下：</p><p>$$ \begin{align*} S &= (P,T)\\ S_t &= (P_t,T_t)\\ &= (f_1(t,P,T),\ f_2(t,P,T))\\ &= (f_1(t,S),\ f_2(t,S)) \end{align*} $$</p><p>$S$ 代表 System，描述整個系統。而有了這個複合向量之後，我們就可以用 RK4 去模擬這個問題了！以下為核心 code：</p><div class="fold"><div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-28ab9646" role="button" aria-expanded="false" aria-controls="collapse-28ab9646"><div class="fold-arrow">▶</div>Unity code</div><div class="fold-content collapse" id="collapse-28ab9646"><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdatePos</span>()</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (pTrans == <span class="hljs-literal">null</span> || tTrans == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br><br>    Sys delta = RK4DESolver(<span class="hljs-keyword">new</span> Sys(pTrans.position, tTrans.position));<br>    pTrans.position += delta.P;<br>    tTrans.position += delta.T;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> Sys <span class="hljs-title">RK4DESolver</span>(<span class="hljs-params">Sys s</span>)</span><br>&#123;<br>    Sys k1 = dS(tTotal, s),<br>        k2 = dS(tTotal + dt / <span class="hljs-number">2</span>, s + k1 * (dt / <span class="hljs-number">2</span>)),<br>        k3 = dS(tTotal + dt / <span class="hljs-number">2</span>, s + k2 * (dt / <span class="hljs-number">2</span>)),<br>        k4 = dS(tTotal + dt, s + k3 * dt);<br><br>    Sys avr = (k1 + (<span class="hljs-number">2</span> * k2) + (<span class="hljs-number">2</span> * k3) + k4) / <span class="hljs-number">6</span>;<br><br>    <span class="hljs-keyword">return</span> avr * dt;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> Sys <span class="hljs-title">dS</span>(<span class="hljs-params"><span class="hljs-built_in">float</span> t, Sys s</span>)</span><br>&#123;<br>    Vector3 dirVec = (s.T - s.P).normalized;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Sys(<br>        vP * dirVec,<br>        vT * (<br>            dirVec * (<span class="hljs-number">1</span>-alpha) + XYRotation(tiltVector(t), Mathf.Atan2(dirVec.y, dirVec.x)) * alpha<br>        ).normalized<br>    );<br>&#125;<br></code></pre></td></tr></table></figure></div></div><blockquote><p>其中 Sys 實作是利用 struct + operator overload。</p></blockquote><p>說了一堆奇怪的數學術語，是時候來看一些模擬圖了！</p><blockquote><p>參數使用：</p></blockquote><p>$$ \begin{align*} A(k) &= \frac{k\pi}{180}\\ \hat{\tau}(t,k) &= \left(\cos(x), \sin(x)\right),\ x = \cos(t)A(k) \end{align*} $$</p><p>$A(k)$ 是角度範圍修正量。</p><blockquote><p>紅色是人，藍色是鬼</p></blockquote><p><img src="simu45.avif" srcset="/img/placeholder.webp" lazyload alt="$\hat{\tau}(t, 45)$"><br><img src="simu30.avif" srcset="/img/placeholder.webp" lazyload alt="$\hat{\tau}(t, 30)$"></p><p>人稍微跑慢一點就變醬了qq：</p><p><img src="too_slow.avif" srcset="/img/placeholder.webp" lazyload alt="$V_T/V_P = 0.9$"></p><p>從上面模擬結果可知：跑的時候不要亂擺來擺去，跑直線最好 owo。</p><div class="video-container"><iframe src="https://www.youtube.com/embed/pIOTvZjVlv0" frameborder="0" loading="lazy" allowfullscreen></iframe></div><h2 id="後記">後記</h2><p>在這邊特別感謝那位台大物理朋朋，被我硬塞了一堆奇怪的東東 owo。</p><blockquote><p>也要感謝新室友，也被我塞了一堆奇怪的東東 uwu。</p></blockquote><p>總之，就是一個寫紀錄文寫到一半時突然想起某個氣死人的事情並對其狂酸的筆者。</p><p>那麼，就醬 uwu（心情舒爽多了。</p><h2 id="註腳">註腳</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>假設玩家可以存活到被拉到 WoF 身旁，且拉的速度為等速。 <a href="#fnref:1" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span>其實有想詳細研究過，但被打斷了，詳細原因等等再說。 <a href="#fnref:2" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span>簡述一下那位物理老師的話：「你連怎麼說這個情況都會說不清楚那還解甚麼題目，但老師還是幫你看一下，<strong>看了 1 分鐘多</strong>，啊這個老師也不知道怎麼解要想一下。」直接笑死，根本不會解；不過完全不意外，蠻多筆者遇過的補習班老師在問同領域的課外問題時的回應幾乎都是「要想一下」，那時早就習慣了##。 <a href="#fnref:3" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span>我是來學習不是來聽文不對題的廢話。 <a href="#fnref:4" rev="footnote" class="footnote-backref">↩</a></span></span></li></ol></div></section></div><hr><div><div class="post-metas my-3"><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/mafs/" class="print-no-link">#mafs</a> <a href="/tags/program/" class="print-no-link">#program</a> <a href="/tags/life/" class="print-no-link">#life</a></div></div><div class="license-box my-3"><div class="license-title"><div>有關追蹤曲線</div><div>https://phantom0174.github.io/2023/08/pursuit-curve/</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>phantom0174</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>August 27, 2023</div></div><div class="license-meta-item license-meta-date"><div>Updated on</div><div>September 10, 2023</div></div><div class="license-meta-item"><div>Licensed under</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - Non-commercial"><i class="iconfont icon-nc"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - Share-alike"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/09/my-first-cpp/" title="進競程大觀園"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">進競程大觀園</span> <span class="visible-mobile">Next</span></a></article><article class="post-next col-6"><a href="/2023/07/async-traverser/" title="Async Traverser 小介紹"><span class="hidden-mobile">Async Traverser 小介紹</span> <span class="visible-mobile">Previous</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><div id="disqus_recommendations"></div><article id="comments" lazyload><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script type="text/javascript">var disqus_config=function(){this.page.url="https://phantom0174.github.io/2023/08/pursuit-curve/",this.page.identifier="/2023/08/pursuit-curve/"};Fluid.utils.loadComments("#disqus_thread",function(){var t=document,e=t.createElement("script");e.src="//quantamis-realm.disqus.com/embed.js",e.setAttribute("data-timestamp",new Date),(t.head||t.body).appendChild(e)})</script><noscript>Please enable JavaScript to view the comments</noscript></div></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none"><i class="icomoon-eye"></i> <span id="leancloud-site-pv"></span> </span><span id="leancloud-site-uv-container" style="display:none"><i class="icomoon-user"></i> <span id="leancloud-site-uv"></span></span></div></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="preload" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,i=t.getElementById("subtitle");i&&e&&e(i.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;0<t.find(".toc-list-item").length&&t.css("visibility","visible")}}))})</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });</script><script>Fluid.utils.createScript("https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript><script>!function(){var t=document,e=t.createElement("script");e.src="https://quantamis-realm.disqus.com/recommendations.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><script>document.addEventListener("DOMContentLoaded", function() {
        katex_list = document.getElementsByClassName('katex');
        for (let i = 0; i < katex_list.length; i++) {
            katex_list[i].classList.add('notranslate');
        }
    });</script><style>body{transition:none!important}</style></body></html>