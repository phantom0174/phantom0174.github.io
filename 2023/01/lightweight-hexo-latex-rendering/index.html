<!DOCTYPE html><html lang="en"><head><style>@import url(https://fonts.googleapis.com/css2?family=Fira+Code&display=swap);code,pre>span{font-family:'Fira Code',sans-serif!important;font-display:swap}</style><style>.video-container{position:relative;padding-bottom:56.25%;padding-top:30px;margin-bottom:16px;height:0;overflow:hidden}.video-container embed,.video-container iframe,.video-container object{position:absolute;top:0;left:0;width:100%;height:100%}</style><style>.group-image-wrap{align-items:center}.group-image-wrap .fancybox{width:-webkit-fill-available;width:-moz-fill-available;width:-moz-available;width:fill-available}.group-image-container img{width:-webkit-fill-available;width:-moz-fill-available;width:-moz-available;width:fill-available}.post-content img{max-height:350px}</style><style>.markdown-body>table{display:table!important}</style><style>@media (min-width:992px){.post-content,post-custom{padding-left:12%!important;padding-right:12%!important}}</style><style>h1,h2,h3,h4,h5,h6,h7{font-family:"PingFang SC","Hiragino Sans GB","Microsoft Yahei","WenQuanYi Micro Hei","Segoe UI Emoji","Segoe UI Symbol",Helvetica,Arial,-apple-system,system-ui,sans-serif!important}</style><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.webp"><link rel="icon" href="/img/favicon.webp"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="phantom0174"><meta name="keywords" content="hexo, theme, fluid, latex, katex, 數學式, 渲染, 程式, python"><meta name="description" content="用簡單的方式，幫你節省下最多 94.9% 的空間使用"><meta property="og:type" content="article"><meta property="og:title" content="HEXO 輕量級 LaTeX 渲染"><meta property="og:url" content="https://blog.phantom0174.online/2023/01/lightweight-hexo-latex-rendering/index.html"><meta property="og:site_name" content="Quantami"><meta property="og:description" content="用簡單的方式，幫你節省下最多 94.9% 的空間使用"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://blog.phantom0174.online/assets/cover/lightweight_hexo_latex_rendering.webp"><meta property="article:published_time" content="2023-01-17T13:14:00.000Z"><meta property="article:modified_time" content="2023-01-28T09:43:00.000Z"><meta property="article:author" content="phantom0174"><meta property="article:tag" content="program"><meta property="article:tag" content="mafs"><meta property="article:tag" content="hexo"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://blog.phantom0174.online/assets/cover/lightweight_hexo_latex_rendering.webp"><title>HEXO 輕量級 LaTeX 渲染 | Quantami</title><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.1/css/bootstrap.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.7.0/hint.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="preload" href="/css/main.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link id="highlight-css" rel="preload" href="/css/highlight.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link id="highlight-css-dark" rel="preload" href="/css/highlight-dark.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><link rel="stylesheet" href="/css/fonts.css"><link rel="preload" href="/css/icomoon/style.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"blog.phantom0174.online",root:"/",version:"1.9.5",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:["post"]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:"❡"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/placeholder.webp",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:{measurement_id:"G-7FGHSBCQB5"},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"rOQP33bXoE3wMPKnTsA70Duj-MdYXbMMI",app_key:"7BbpOToJ4BxNyKA2EgBND34r",server_url:null,path:"window.location.pathname",ignore_local:!0}},search_path:"/local-search.xml",include_content_in_search:!0};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-7FGHSBCQB5",function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","G-7FGHSBCQB5")})</script><style>.toc-title{font-weight:700!important;font-size:1.7em}.toc{font-weight:700!important}.toc-level-1{font-size:1.3rem}.toc-level-2{font-size:1.2rem}.toc-level-3{font-size:1.1rem}</style><style>.katex>.katex-html{white-space:nowrap;overflow-x:scroll;overflow-y:hidden}.katex>.katex-html>.tag{position:relative!important;left:10%!important}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css" integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js" integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><style>#subtitle,.typed-cursor{font-size:2.2rem;animation:blinking 2s ease-in-out .5s infinite alternate}@keyframes blinking{from{text-shadow:none}to{text-shadow:0 0 10px #fc0,0 0 20px #fc0,0 0 40px #fc0}}@media (max-width:991px){#subtitle,.typed-cursor{font-size:2.1rem}}@media (max-width:767px){#subtitle,.typed-cursor{font-size:2rem}}@media (max-width:544px){#subtitle,.typed-cursor{font-size:1.8rem}}@media (max-width:432px){#subtitle,.typed-cursor{font-size:1.6rem}}</style><style type="text/css">.spoiler{display:inline}p.spoiler{display:flex}.spoiler a{pointer-events:none}.spoiler-blur,.spoiler-blur>*{transition:text-shadow .5s ease}.spoiler .spoiler-blur,.spoiler .spoiler-blur>*{color:transparent;background-color:rgba(0,0,0,0);text-shadow:0 0 10px grey;cursor:pointer}.spoiler .spoiler-blur:hover,.spoiler .spoiler-blur:hover>*{text-shadow:0 0 5px grey}.spoiler-box,.spoiler-box>*{transition:color .5s ease,background-color .5s ease}.spoiler .spoiler-box,.spoiler .spoiler-box>*{color:#000;background-color:#000;text-shadow:none}</style><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/rss.xml" title="Quantami" type="application/rss+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Quantami</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>Archive</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>About</span></a></li><li class="nav-item"><a class="nav-link" href="/links/" target="_self"><i class="iconfont icon-link-fill"></i> <span>Friends</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-bookmark-fill"></i> <span>Others</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/2023/11/site-logs/" target="_self"><i class="iconfont icon-cliplist"></i> <span>Site logs</span> </a><a class="dropdown-item" href="/subscription/" target="_self"><i class="iconfont icon-rss"></i> <span>Subscription</span></a></div></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/assets/cover/lightweight_hexo_latex_rendering.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.5)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="HEXO 輕量級 LaTeX 渲染"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-01-17 21:14" pubdate>Tuesday, January 17th 2023, 9:14 pm</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 1.9k words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 19 mins </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> views</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="col-lg-10 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">HEXO 輕量級 LaTeX 渲染</h1><p class="note note-light">Last updated on January 28, 2023</p><div class="markdown-body"><p class="toc-title">Contents</p><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%BE%E8%B3%87%E6%96%99%EF%BC%8C%E5%8D%A1%E4%BD%8F"><span class="toc-text">找資料，卡住</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%BD%E5%83%8F%E5%8F%AF%E4%BB%A5%E8%A7%A3%E6%B1%BA%EF%BC%9F"><span class="toc-text">好像可以解決？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%A6%E4%BD%9C%E9%81%8E%E7%A8%8B"><span class="toc-text">實作過程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%8C%E8%A8%98"><span class="toc-text">後記</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%83%E8%80%83"><span class="toc-text">參考</span></a></li></ol><h2 id="前言">前言</h2><p>本文適用於正在使用 <code>@traptitech/markdown-it-katex</code> 套件進行 HEXO 文章中 LaTeX 語法渲染，且與筆者一樣，都有強迫症的人。</p><h2 id="正文">正文</h2><p>不知道你是否曾經為 HEXO 所生成出的厚重檔案所苦？<br>尤其是當原始 md 檔裡面有許多 LaTeX 語法時，生成出來的東西就會像這樣：</p><p><img src="0.png" srcset="/img/placeholder.webp" lazyload alt=""></p><blockquote><p>os: 亂糟糟 超級多密密麻麻的東西看了就不舒服qq</p></blockquote><p>就如上圖的情況，原本 15KB 的 md 檔，經過 <code>hexo g</code> 魔法後，整整膨脹了 <strong>37.87倍</strong>，來到了 <strong>568KB</strong>。<br>考量到 Github Pages 只有最多1GB的空間，筆者決定要解決這個亂象。</p><h3 id="找資料，卡住">找資料，卡住</h3><p>找了許久，最有印象的是這篇教學文章<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="http://lowrank.science/Hexo-KaTeX/">[1]</span></a></sup>，簡單整理下它的重點：</p><ol><li>移除 <code>@traptitech/markdown-it-katex</code></li><li>使用 KaTeX 官網附贈的 Auto-render Extension<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://katex.org/docs/autorender.html">[2]</span></a></sup></li><li>卡住，遇到問題</li></ol><p>為什麼會遇到問題？因為在 <code>md -&gt; html</code> 的過程中，會進行字元跳脫等轉譯動作（筆者對這方面正確用詞不是太熟悉，還請見諒）。<br>也就是把 <code>&amp;</code> 轉成 <code>&amp;amp</code>；把 <code>_哈哈_</code> 轉成 <code>&lt;em&gt;哈哈&lt;/em&gt;</code>；諸如此類。<br>但這就出問題了，因為我們在 md 檔中所寫的 LaTeX 語法，也會有一樣的命運。</p><p>首先第一個問題，就是在過程中，會把換行變成 <code>&lt;br&gt;</code>。<br>如果有一行 LaTeX 語法長這樣：</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-built_in">$</span><span class="hljs-built_in">$</span><br>A<span class="hljs-built_in">_</span>i+B<span class="hljs-built_in">_</span>j=C<span class="hljs-built_in">_</span>k<br><span class="hljs-built_in">$</span><span class="hljs-built_in">$</span><br></code></pre></td></tr></table></figure><p>它最後會渲染錯誤，因為轉換過程中會把換行字元 <code>\n</code> 換成 <code>&lt;br&gt;</code>，而這會把 <code>$$</code> 與接下來的語法分離，Auto-render Extension 自然也無法辨識這是一個由 <code>$$</code> 作為開頭的LaTeX語法了。</p><p>這個問題解決方法還算簡單，只要把所有東西都寫在同一行上就結束，只是略略減少了可讀性。<br>但問題是出在於第二個問題 <strong>很煩</strong>。</p><p>第二個問題，以筆者的經驗為例。有一個 LaTeX 語法：</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-built_in">$</span><span class="hljs-built_in">$</span><span class="hljs-keyword">\frac</span>&#123;f&#125;&#123;g&#125; = <span class="hljs-keyword">\sum</span><span class="hljs-built_in">_</span>&#123;<span class="hljs-keyword">\omega</span><span class="hljs-keyword">\in</span> <span class="hljs-keyword">\mathbb</span>&#123;Z&#125;<span class="hljs-built_in">_</span>g&#125;<span class="hljs-keyword">\left</span>(<span class="hljs-keyword">\frac</span>&#123;f(u)&#125;&#123;g&#x27;(u)&#125;<span class="hljs-keyword">\Big</span>|<span class="hljs-built_in">_</span>&#123;u=<span class="hljs-keyword">\omega</span>&#125;<span class="hljs-keyword">\cdot</span><span class="hljs-keyword">\frac</span>&#123;1&#125;&#123;x-<span class="hljs-keyword">\omega</span>&#125;<span class="hljs-keyword">\right</span>)<span class="hljs-built_in">$</span><span class="hljs-built_in">$</span><br></code></pre></td></tr></table></figure><p>結果在渲染出來時，它變成了：</p><p><img src="1.png" srcset="/img/placeholder.webp" lazyload alt="錯誤的渲染結果"></p><p>仔細即可看出原因：它把原始語法中的 <code>_g&#125;\left(\frac&#123;f(u)&#125;&#123;g'(u)&#125;\Big|_</code> 的左右兩個 <code>_</code> 看成 md 語法中的 <strong>強調文字</strong> 了。<br>解決方式跟跳脫字元方式一樣：把 <strong>每個</strong> <code>_</code> 前面都多加上 <code>\</code>，變成 <code>_</code> 的跳脫字元。<br>而換行 <code>\\</code> 也有同樣的問題，變成要打 <strong>四個</strong> 反斜線 <code>\\\\</code>。</p><p>但第二個問題的解決方式，顯然嚴重影響了我們在打語法過程中的順暢度，之後如果要修改也相當麻煩，因此必須要找更好的解決方式。</p><h3 id="好像可以解決？">好像可以解決？</h3><p>但要怎麼不讓我們在 md 檔中寫的 LaTeX 語法與普通的 md 語法做出區別呢？<br>筆者在埋頭找尋解決方式的過程中，偶然看到了在 <code>hexo-renderer-markdown-it</code> 套件<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://github.com/hexojs/hexo-renderer-markdown-it">[3]</span></a></sup>在說明文件上所寫的一段話：</p><p><img src="2.png" srcset="/img/placeholder.webp" lazyload alt="說明文件的一部分"></p><blockquote><p>Render options<br>html<br>The html setting defines whether or not HTML content inside the document should be escaped or passed to the final result.</p></blockquote><p>這如同一線生機：如果我們把這個 option 打開，並利用 <code>&lt;p&gt;...&lt;/p&gt;</code> 把我們在 md 中的 LaTeX 語法包起來，那麼語法就不會受到侵害了。<br>因此，實作過程如下（包括導入 Auto-render Extension）</p><h3 id="實作過程">實作過程</h3><ol><li><p>新增 css 與 Auto-render Extension</p><ol><li>使用 <strong>HEXO注入器</strong><sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://fluid-dev.github.io/hexo-fluid-docs/advance/#hexo-注入代码">[4]</span></a></sup>，在專案的根目錄（<code>root/</code>）新增一個名為 <code>scripts</code> 的資料夾，並在其底下新增名為 <code>katex.js</code> 的檔案。</li></ol><p><img src="3.png" srcset="/img/placeholder.webp" lazyload alt=""></p><ol start="2"><li>將以下程式碼貼入：</li></ol><div class="fold"><div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-1c029561" role="button" aria-expanded="false" aria-controls="collapse-1c029561"><div class="fold-arrow">▶</div>Code</div><div class="fold-content collapse" id="collapse-1c029561"><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript">hexo.<span class="hljs-property">extend</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">&#x27;head_end&#x27;</span>, <span class="hljs-string">`</span><br><span class="hljs-string">    &lt;style&gt;</span><br><span class="hljs-string">        .katex&gt;.katex-html &#123;</span><br><span class="hljs-string">            white-space: nowrap;</span><br><span class="hljs-string">            overflow-x: scroll;</span><br><span class="hljs-string">            overflow-y: hidden;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &lt;/style&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css&quot; integrity=&quot;sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0&quot; crossorigin=&quot;anonymous&quot;&gt;</span><br><span class="hljs-string">    &lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js&quot; integrity=&quot;sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span><br><span class="hljs-string">    &lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js&quot; integrity=&quot;sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span><br><span class="hljs-string">    &lt;script&gt;</span><br><span class="hljs-string">        document.addEventListener(&quot;DOMContentLoaded&quot;, function() &#123;</span><br><span class="hljs-string">            renderMathInElement(document.body, &#123;</span><br><span class="hljs-string">            // customised options</span><br><span class="hljs-string">            // • auto-render specific keys, e.g.:</span><br><span class="hljs-string">            delimiters: [</span><br><span class="hljs-string">                &#123;left: &#x27;$$&#x27;, right: &#x27;$$&#x27;, display: true&#125;,</span><br><span class="hljs-string">                &#123;left: &#x27;$&#x27;, right: &#x27;$&#x27;, display: false&#125;,</span><br><span class="hljs-string">                &#123;left: &#x27;\\(&#x27;, right: &#x27;\\)&#x27;, display: false&#125;,</span><br><span class="hljs-string">                &#123;left: &#x27;\\[&#x27;, right: &#x27;\\]&#x27;, display: true&#125;</span><br><span class="hljs-string">            ],</span><br><span class="hljs-string">            // • rendering keys, e.g.:</span><br><span class="hljs-string">            throwOnError : false</span><br><span class="hljs-string">            &#125;);</span><br><span class="hljs-string">        &#125;);</span><br><span class="hljs-string">    &lt;/script&gt;</span><br><span class="hljs-string">`</span>, <span class="hljs-string">&#x27;default&#x27;</span>);<br></code></pre></td></tr></table></figure></div></div><p>這個程式碼的意思是：在每一個 page 或是 post 所生成的 html 檔的 <code>&lt;head&gt;...&lt;/head&gt;</code> 中，加上<strong>兩個東西</strong>。</p><ul><li>其一，是起始的 css 部分。這是幫超出邊界的數學式加上滾輪視窗。</li></ul><p><img src="4.gif" srcset="/img/placeholder.webp" lazyload alt=""></p><ul><li>其二，是 <code>Auto-render Extension</code> 的程式碼。</li></ul></li><li><p>移除舊套件與設定檔</p><ul><li><p>移除原先使用的 <code>@traptitech/markdown-it-katex</code> 套件，並確認有安裝 <code>hexo-renderer-markdown-it</code> 套件。</p></li><li><p>在 <code>config.yml</code> 中刪除 <code>@traptitech/markdown-it-katex</code> 的設定檔，否則會報錯。</p></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">markdown:</span><br>  <span class="hljs-attr">plugins:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;@traptitech/markdown-it-katex&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>讓包在 <code>&lt;p&gt;...&lt;/p&gt;</code> 中的 latex 語法不要受侵蝕。<br>在 <code>config.yml</code> 中新增以下設定檔</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">markdown:</span><br>  <span class="hljs-attr">render:</span><br>    <span class="hljs-attr">html:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure></li><li><p>新增自動化程式，用 <code>&lt;p&gt;...&lt;/p&gt;</code> 保護所有 <code>.md</code> 檔中的 latex 語法。</p><div class="note note-warning"><p>底下程式是早期的版本，更好的程式請見 <strong><a target="_blank" rel="noopener" href="https://phantom0174.github.io/2023/01/latex-protector/">此文章</a></strong>。</p></div><ol><li>在 <code>./source/</code> 底下新增名為 <code>latex_protector.py</code> 的檔案，並將以下程式碼複製貼上：</li></ol><p><img src="5.png" srcset="/img/placeholder.webp" lazyload alt=""></p><div class="fold"><div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-5b5bd572" role="button" aria-expanded="false" aria-controls="collapse-5b5bd572"><div class="fold-arrow">▶</div>太長了所以先折起來</div><div class="fold-content collapse" id="collapse-5b5bd572"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br><br><span class="hljs-comment"># must ends with &#x27;/&#x27;</span><br>ENTRIES_TO_PROTECT_UNDER_SOURCE_FOLDER = [<br>    <span class="hljs-string">&#x27;./about/&#x27;</span>,<br>    <span class="hljs-string">&#x27;./_posts/&#x27;</span><br>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">protect_md_file</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        content: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>] = file.read().split(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br>    new = []<br><br>    status = <span class="hljs-string">&quot;i&quot;</span><br>    <span class="hljs-keyword">for</span> (i, line) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(content):<br>        <span class="hljs-keyword">if</span> status == <span class="hljs-string">&quot;i&quot;</span> <span class="hljs-keyword">and</span> line.startswith(<span class="hljs-string">&quot;$$&quot;</span>) <span class="hljs-keyword">and</span> line.endswith(<span class="hljs-string">&quot;$$&quot;</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(line) &gt; <span class="hljs-number">2</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> content[i-<span class="hljs-number">1</span>].startswith(<span class="hljs-string">&quot;&lt;p&gt;&quot;</span>):<br>                new.append(<span class="hljs-string">&quot;&lt;p&gt;&quot;</span>)<br>            <br>            new.append(line)<br>            <br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> content[i+<span class="hljs-number">1</span>].startswith(<span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>):<br>                new.append(<span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>)<br>            <br>        <span class="hljs-keyword">elif</span> status == <span class="hljs-string">&quot;i&quot;</span> <span class="hljs-keyword">and</span> line.startswith(<span class="hljs-string">&quot;$$&quot;</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> content[i-<span class="hljs-number">1</span>].startswith(<span class="hljs-string">&quot;&lt;p&gt;&quot;</span>):<br>                new.append(<span class="hljs-string">&quot;&lt;p&gt;&quot;</span>)<br>            <br>            new.append(line)<br>            status = <span class="hljs-string">&quot;e&quot;</span><br>        <br>        <span class="hljs-keyword">elif</span> status == <span class="hljs-string">&quot;e&quot;</span> <span class="hljs-keyword">and</span> line.endswith(<span class="hljs-string">&quot;$$&quot;</span>):<br>            new.append(line)<br>            <br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> content[i+<span class="hljs-number">1</span>].startswith(<span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>):<br>                new.append(<span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>)<br>            <br>            status = <span class="hljs-string">&#x27;i&#x27;</span><br>        <br>        <span class="hljs-keyword">else</span>:<br>            new.append(line)<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        file.write(<span class="hljs-string">&#x27;\n&#x27;</span>.join(new))<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;[Protected] <span class="hljs-subst">&#123;file_path&#125;</span>&#x27;</span>)<br><br><br><span class="hljs-comment"># root_path ended with &#x27;/&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">traverse_folder</span>(<span class="hljs-params">root_path</span>):<br>    <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> os.listdir(root_path):<br>        <span class="hljs-keyword">if</span> filename.endswith(<span class="hljs-string">&#x27;.md&#x27;</span>):<br>            protect_md_file(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;root_path&#125;</span><span class="hljs-subst">&#123;filename&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">elif</span> filename.find(<span class="hljs-string">&#x27;.&#x27;</span>) == -<span class="hljs-number">1</span>:<br>            traverse_folder(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;root_path&#125;</span><span class="hljs-subst">&#123;filename&#125;</span>/&#x27;</span>)<br><br><br><span class="hljs-keyword">for</span> entry <span class="hljs-keyword">in</span> ENTRIES_TO_PROTECT_UNDER_SOURCE_FOLDER:<br>    traverse_folder(entry)<br></code></pre></td></tr></table></figure></div></div><ol start="2"><li><p>將 <code>ENTRIES_TO_PROTECT_UNDER_SOURCE_FOLDER</code> 中新增你想要保護的 <strong>資料夾根目錄</strong>（與 <code>_post</code> 同等級的）。</p><blockquote><p>筆者在 <code>./source/_posts/</code> 與 <code>./source/about/</code> 底下的 md 檔中都有用到 LaTeX 語法，因此是預設這兩個目錄。</p></blockquote></li><li><p>執行 <code>latex_protector.py</code>，程式會自行遞迴去找資料夾裡面所有的 md 檔，並回報保護訊息。</p></li></ol><ul><li>須知，這個程式碼只會識別將所有以 <code>$$...$$</code> 包起來的 LaTeX 區塊，如果 inline LaTeX (<code>$...$</code>) 在渲染上有些問題，請手動幫其加上 <code>&lt;p&gt;...&lt;/p&gt;</code>。</li></ul></li><li><p>使用 <code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</code> 進行預覽，沒問題的話即可deploy。</p><ul><li>之後每次 deploy 前都請記得執行 <code>latex_protector.py</code>。</li></ul></li><li><p>大功告成！</p></li></ol><h2 id="後記">後記</h2><p>在經過我們的 <del>調教</del> 修理後，原本15KB的檔案生成後只有 <strong>34KB</strong>。<br>相比原來結果，空間節省率高達 <strong>94%</strong>。<br>甚至還可以更進一步，在 <code>hexo-neat</code> 的壓縮之下，檔案大小來到了 <strong>29KB</strong>；空間節省率微增，來到了 <strong>94.9%</strong>。</p><p>如此一來，就可以寫更多的文章了（灑花\^~^/。</p><hr><p>p.s. 手一樣好酸owo</p><h2 id="參考">參考</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a target="_blank" rel="noopener" href="http://lowrank.science/Hexo-KaTeX/">http://lowrank.science/Hexo-KaTeX/</a> <a href="#fnref:1" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://katex.org/docs/autorender.html">https://katex.org/docs/autorender.html</a> <a href="#fnref:2" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo-renderer-markdown-it">https://github.com/hexojs/hexo-renderer-markdown-it</a> <a href="#fnref:3" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://fluid-dev.github.io/hexo-fluid-docs/advance/#hexo-%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81">https://fluid-dev.github.io/hexo-fluid-docs/advance/#hexo-注入代码</a> <a href="#fnref:4" rev="footnote" class="footnote-backref">↩</a></span></span></li></ol></div></section></div><hr><div><div class="post-metas my-3"><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/program/" class="print-no-link">#program</a> <a href="/tags/mafs/" class="print-no-link">#mafs</a> <a href="/tags/hexo/" class="print-no-link">#hexo</a></div></div><div class="license-box my-3"><div class="license-title"><div>HEXO 輕量級 LaTeX 渲染</div><div>https://blog.phantom0174.online/2023/01/lightweight-hexo-latex-rendering/</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>phantom0174</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>January 17, 2023</div></div><div class="license-meta-item license-meta-date"><div>Updated on</div><div>January 28, 2023</div></div><div class="license-meta-item"><div>Licensed under</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - Non-commercial"><i class="iconfont icon-nc"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - Share-alike"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/01/mafs-mixture/" title="放點新奇的數學東西"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">放點新奇的數學東西</span> <span class="visible-mobile">Next</span></a></article><article class="post-next col-6"><a href="/2023/01/compute-that-strange-integral/" title="關於我怎麼算出那個奇怪積分的"><span class="hidden-mobile">關於我怎麼算出那個奇怪積分的</span> <span class="visible-mobile">Previous</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><div id="disqus_recommendations"></div><article id="comments" lazyload><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script type="text/javascript">var disqus_config=function(){this.page.url="https://blog.phantom0174.online/2023/01/lightweight-hexo-latex-rendering/",this.page.identifier="/2023/01/lightweight-hexo-latex-rendering/"};Fluid.utils.loadComments("#disqus_thread",function(){var e=document,t=e.createElement("script");t.src="//quantamis-realm.disqus.com/embed.js",t.setAttribute("data-timestamp",new Date),(e.head||e.body).appendChild(t)})</script><noscript>Please enable JavaScript to view the comments</noscript></div></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none"><i class="icomoon-eye"></i> <span id="leancloud-site-pv"></span> </span><span id="leancloud-site-uv-container" style="display:none"><i class="icomoon-user"></i> <span id="leancloud-site-uv"></span></span></div></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="preload" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,i=t.getElementById("subtitle");i&&e&&e(i.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;0<t.find(".toc-list-item").length&&t.css("visibility","visible")}}))})</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });</script><script>Fluid.utils.createScript("https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript><script>document.addEventListener("DOMContentLoaded", function() {
        katex_list = document.getElementsByClassName('katex');
        for (let i = 0; i < katex_list.length; i++) {
            katex_list[i].classList.add('notranslate');
        }
    });</script><script>!function(){var t=document,e=t.createElement("script");e.src="https://quantamis-realm.disqus.com/recommendations.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><style>body{transition:none!important}</style></body></html>